import{r as o,u as _,d as H,j as e,c as M,P as R,f as Q,L as D,M as J,F as U,t as z,V as $}from"./ui-3vQ9-yJw.js";import{o as W,c as T,a as K,b as V,e as X,u as G}from"./index-sJx7Xdqp.js";import{B as b}from"./button-BxgNf8B1.js";import{I as k}from"./input-DhaQutbK.js";import{C as P,a as E,b as Y,c as Z}from"./card-C-wb9owH.js";import{B as ee}from"./badge-DiQtRYnG.js";import{u as se}from"./index-CL2D7O4A.js";import{L as N}from"./label-CG0jOVEo.js";import{D as te,a as ae,b as re,c as ne,d as ie,A as oe,m as ce,f as le,g as de,h as ue,i as he,j as me,k as pe,l as fe}from"./alert-dialog-4hHLxoKE.js";import"./vendor-C0Dkio3Y.js";import"./firebase-CupIkEz0.js";var O="Switch",[xe]=M(O),[ge,we]=xe(O),A=o.forwardRef((t,u)=>{const{__scopeSwitch:a,name:r,checked:c,defaultChecked:f,required:h,disabled:n,value:l="on",onCheckedChange:x,form:g,...m}=t,[p,y]=o.useState(null),S=_(u,d=>y(d)),v=o.useRef(!1),j=p?g||!!p.closest("form"):!0,[s=!1,i]=H({prop:c,defaultProp:f,onChange:x});return e.jsxs(ge,{scope:a,checked:s,disabled:n,children:[e.jsx(R.button,{type:"button",role:"switch","aria-checked":s,"aria-required":h,"data-state":q(s),"data-disabled":n?"":void 0,disabled:n,value:l,...m,ref:S,onClick:Q(t.onClick,d=>{i(w=>!w),j&&(v.current=d.isPropagationStopped(),v.current||d.stopPropagation())})}),j&&e.jsx(ve,{control:p,bubbles:!v.current,name:r,value:l,checked:s,required:h,disabled:n,form:g,style:{transform:"translateX(-100%)"}})]})});A.displayName=O;var F="SwitchThumb",L=o.forwardRef((t,u)=>{const{__scopeSwitch:a,...r}=t,c=we(F,a);return e.jsx(R.span,{"data-state":q(c.checked),"data-disabled":c.disabled?"":void 0,...r,ref:u})});L.displayName=F;var ve=t=>{const{control:u,checked:a,bubbles:r=!0,...c}=t,f=o.useRef(null),h=se(a),n=W(u);return o.useEffect(()=>{const l=f.current,x=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(x,"checked").set;if(h!==a&&m){const p=new Event("click",{bubbles:r});m.call(l,a),l.dispatchEvent(p)}},[h,a,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...c,tabIndex:-1,ref:f,style:{...t.style,...n,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function q(t){return t?"checked":"unchecked"}var B=A,je=L;const I=o.forwardRef(({className:t,...u},a)=>e.jsx(B,{className:T("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...u,ref:a,children:e.jsx(je,{className:T("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));I.displayName=B.displayName;function Re(){const[t,u]=o.useState(null),[,a]=K(),{toast:r}=V(),c=X(),[f,h]=o.useState(!1),[n,l]=o.useState({username:"",password:"",name:""}),[x,g]=o.useState(!1);o.useEffect(()=>{const s=localStorage.getItem("owner_session");if(!s){a("/owner/login");return}const i=JSON.parse(s);u(i)},[a]);const{data:m=[],isLoading:p}=G({queryKey:["ownerResidencies",t?.username],queryFn:async()=>{if(!t?.username)return[];const s=await fetch(`/api/ownerResidencies?username=${t.username}`);if(!s.ok)throw new Error("Failed to fetch");return(await s.json()).residencies||[]},enabled:!!t?.username,refetchInterval:3e3}),y=async(s,i)=>{const d=i==="ON"?"OFF":"ON";c.setQueryData(["ownerResidencies",t?.username],w=>w.map(C=>C.id===s?{...C,serviceStatus:d}:C));try{if(!(await fetch("/api/toggleService",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({residencyId:s,status:d})})).ok)throw new Error("Failed to update");r({title:"Success",description:`Service turned ${d}`})}catch(w){console.error("Toggle error:",w),r({title:"Error",description:"Failed to update status",variant:"destructive"}),c.invalidateQueries(["ownerResidencies",t?.username])}},S=async s=>{try{if(!(await fetch("/api/deleteResidency",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({residencyId:s})})).ok)throw new Error("Failed to delete");r({title:"Success",description:"Residency deleted successfully"}),c.invalidateQueries(["ownerResidencies",t?.username])}catch(i){console.error("Delete error:",i),r({title:"Error",description:"Failed to delete residency",variant:"destructive"})}},v=()=>{localStorage.removeItem("owner_session"),a("/owner-login")},j=async s=>{s.preventDefault(),g(!0);try{const i=await fetch("/api/createOwner",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(i.ok)r({title:"Success",description:"New owner created successfully"}),h(!1),l({username:"",password:"",name:""});else{const d=await i.json();r({title:"Error",description:d.message,variant:"destructive"})}}catch{r({title:"Error",description:"Failed to create owner",variant:"destructive"})}finally{g(!1)}};return p&&!m.length?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(D,{className:"animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-slate-50 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Owner Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome, ",t?.name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{open:f,onOpenChange:h,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(b,{variant:"outline",children:[e.jsx(J,{className:"mr-2 h-4 w-4"})," Add Owner"]})}),e.jsxs(re,{children:[e.jsx(ne,{children:e.jsx(ie,{children:"Add New Owner"})}),e.jsxs("form",{onSubmit:j,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Name"}),e.jsx(k,{value:n.name,onChange:s=>l({...n,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Username"}),e.jsx(k,{value:n.username,onChange:s=>l({...n,username:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Password"}),e.jsx(k,{type:"password",value:n.password,onChange:s=>l({...n,password:s.target.value}),required:!0})]}),e.jsx(b,{type:"submit",className:"w-full",disabled:x,children:x?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):"Create Owner"})]})]})]}),e.jsxs(b,{variant:"destructive",onClick:v,children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Logout"]})]})]}),e.jsx("div",{className:"grid gap-6",children:m.length===0?e.jsx(P,{children:e.jsx(E,{className:"p-6 text-center text-muted-foreground",children:"No residencies found for this account."})}):m.map(s=>e.jsxs(P,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(Z,{className:"text-xl font-medium",children:s.name})]}),e.jsx(ee,{variant:s.serviceStatus==="ON"?"default":"destructive",children:s.serviceStatus||"ON"})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{className:"text-base",children:"Service Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.serviceStatus==="ON"?"Service is active. Users can access the portal.":"Service is disabled. Users will see maintenance page."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{checked:s.serviceStatus==="ON",onCheckedChange:()=>y(s.id,s.serviceStatus||"ON")}),e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(b,{variant:"destructive",size:"icon",children:e.jsx($,{className:"h-4 w-4"})})}),e.jsxs(le,{children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Are you sure?"}),e.jsxs(he,{children:['This action cannot be undone. This will permanently delete the residency "',s.name,'" from the database.']})]}),e.jsxs(me,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(fe,{onClick:()=>S(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})]},s.id))})]})})}export{Re as default};
