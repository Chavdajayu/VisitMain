import{r as j,j as e,L as b,S as I}from"./ui-3vQ9-yJw.js";import{u as D,F as X,a as d,b as o,c as l,d as c,e as m,t as K}from"./form-DmsWy2lV.js";import{i as M}from"./types-DkwUutMY.js";import{u as p,s as f,c as $,a as z,b as A}from"./index-sJx7Xdqp.js";import{u as H}from"./use-visitor-requests-BBxtUmkU.js";import{B as J}from"./button-BxgNf8B1.js";import{I as h}from"./input-DhaQutbK.js";import{S as N,a as v,b as w,c as S,d as F}from"./select-BvEVGBYH.js";import{C,b as O,c as Q,d as U,a as W}from"./card-C-wb9owH.js";import{m as G}from"./proxy-Dkg6DtWx.js";import"./vendor-C0Dkio3Y.js";import"./label-CG0jOVEo.js";import"./firebase-CupIkEz0.js";import"./useMutation-NgwOv-kr.js";import"./index-C-65KjJ3.js";import"./index-CL2D7O4A.js";function Y(s){return p({queryKey:["/api/residency",s],enabled:!!s,queryFn:async()=>s?await f.getResidencyByName(s):null})}function Z(s){return p({queryKey:["/api/blocks",s],queryFn:async()=>await f.getBlocks(s)})}function _(s,a){return p({queryKey:["/api/blocks/flats",s,a],enabled:!!s,queryFn:async()=>{if(!s)throw new Error("Block ID required");return await f.getFlatsByBlock(s,a)}})}const q=j.forwardRef(({className:s,...a},u)=>e.jsx("textarea",{className:$("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:u,...a}));q.displayName="Textarea";function pe({residencyName:s}){const a=s?decodeURIComponent(s):void 0,[,u]=z(),{toast:x}=A(),[y,B]=j.useState(null),{data:t,isLoading:E,isError:V}=Y(a),{data:R}=Z(t?.id),{data:k,isLoading:L}=_(y??void 0,t?.id),{mutateAsync:P,isPending:g}=H();j.useEffect(()=>{t?.name&&(document.title=`${t.name} Visitor Form`)},[t?.name]);const n=D({resolver:K(M),defaultValues:{visitorName:"",visitorPhone:"",flatId:"",purpose:"",vehicleNumber:""}}),T=async r=>{if(!t?.id){x({title:"Error",description:"Residency not found",variant:"destructive"});return}try{const i=await P({data:r,residencyId:t.id,residencyName:t.name});x({title:"Request Sent",description:"Waiting for resident approval."}),u(`/visitor-success?id=${i}&residencyId=${t.id}`)}catch(i){console.error("Error submitting form: ",i),x({title:"Error",description:i.message||"There was an error submitting the form",variant:"destructive"})}};return E?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"})}):V||!t?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50",children:e.jsxs(C,{className:"max-w-md w-full p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-destructive mb-2",children:"Residency Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The society you are looking for does not exist or the link is incorrect."})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4",children:e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-lg",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center h-16 w-16 rounded-2xl bg-primary text-primary-foreground mb-4 shadow-xl shadow-primary/30",children:e.jsx(I,{className:"h-8 w-8"})}),e.jsx("h1",{className:"text-3xl font-display font-bold text-slate-900",children:"SecureEntry"}),e.jsxs("h3",{className:"text-xl font-semibold text-slate-700 mt-2",children:[t.name," Visitor Form"]}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Visitor Entry Management System"})]}),e.jsxs(C,{className:"border-t-4 border-t-primary shadow-xl",children:[e.jsxs(O,{children:[e.jsx(Q,{className:"text-xl",children:"New Visitor Entry"}),e.jsx(U,{children:"Enter your details to request access."})]}),e.jsx(W,{children:e.jsx(X,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(T),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{control:n.control,name:"visitorName",render:({field:r})=>e.jsxs(o,{children:[e.jsx(l,{children:"Full Name"}),e.jsx(c,{children:e.jsx(h,{placeholder:"John Doe",...r})}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"visitorPhone",render:({field:r})=>e.jsxs(o,{children:[e.jsx(l,{children:"Phone Number"}),e.jsx(c,{children:e.jsx(h,{placeholder:"9876543210",...r})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(o,{children:[e.jsx(l,{children:"Block"}),e.jsxs(N,{onValueChange:r=>B(r),children:[e.jsx(c,{children:e.jsx(v,{children:e.jsx(w,{placeholder:"Select Block"})})}),e.jsx(S,{children:R?.map(r=>e.jsx(F,{value:String(r.id),children:r.name},r.id))})]})]}),e.jsx(d,{control:n.control,name:"flatId",render:({field:r})=>e.jsxs(o,{children:[e.jsx(l,{children:"Flat"}),e.jsxs(N,{disabled:!y,onValueChange:r.onChange,children:[e.jsx(c,{children:e.jsx(v,{children:e.jsx(w,{placeholder:L?"Loading...":"Select Flat"})})}),e.jsx(S,{children:k?.map(i=>e.jsx(F,{value:String(i.id),children:i.number},i.id))})]}),e.jsx(m,{})]})})]}),e.jsx(d,{control:n.control,name:"purpose",render:({field:r})=>e.jsxs(o,{children:[e.jsx(l,{children:"Purpose of Visit"}),e.jsx(c,{children:e.jsx(q,{placeholder:"Delivery, Meeting, etc.",className:"resize-none",...r})}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"vehicleNumber",render:({field:r})=>e.jsxs(o,{children:[e.jsx(l,{children:"Vehicle Number (Optional)"}),e.jsx(c,{children:e.jsx(h,{placeholder:"XX-00-XX-0000",...r})}),e.jsx(m,{})]})}),e.jsx(J,{type:"submit",className:"w-full",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Request"})]})})})]})]})})}export{pe as default};
