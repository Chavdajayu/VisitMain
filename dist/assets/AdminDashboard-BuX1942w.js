import{r as q,a as E,j as n,L as Ae,G as Se,U as ne,o as H,J as Ie,z as Y,E as re,F as Pe,p as De}from"./ui-3vQ9-yJw.js";import{L as ie}from"./Layout-q0bwL00g.js";import{u as de,s as X,e as Le,a as Oe,d as Fe}from"./index-sJx7Xdqp.js";import{C as O,b as B,c as z,d as Te,a as F}from"./card-C-wb9owH.js";import{B as Be}from"./badge-DiQtRYnG.js";import{B as ae}from"./button-BxgNf8B1.js";import{t as j,c as ze,a as oe,g as Ue,e as _e,d as le,f as U}from"./en-US-BddybvhD.js";import"./vendor-C0Dkio3Y.js";import"./index-C-65KjJ3.js";import"./firebase-CupIkEz0.js";function k(l,i){const a=j(l),u=j(i),d=a.getTime()-u.getTime();return d<0?-1:d>0?1:d}function ke(l){return ze(l,Date.now())}function Qe(l,i){const a=j(l),u=j(i),d=a.getFullYear()-u.getFullYear(),f=a.getMonth()-u.getMonth();return d*12+f}function Ve(l){return i=>{const u=(l?Math[l]:Math.trunc)(i);return u===0?0:u}}function $e(l,i){return+j(l)-+j(i)}function He(l){const i=j(l);return i.setHours(23,59,59,999),i}function Ye(l){const i=j(l),a=i.getMonth();return i.setFullYear(i.getFullYear(),a+1,0),i.setHours(23,59,59,999),i}function Xe(l){const i=j(l);return+He(i)==+Ye(i)}function Ge(l,i){const a=j(l),u=j(i),d=k(a,u),f=Math.abs(Qe(a,u));let w;if(f<1)w=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-d*f);let m=k(a,u)===-d;Xe(j(l))&&f===1&&k(l,u)===1&&(m=!1),w=d*(f-Number(m))}return w===0?0:w}function Ke(l,i,a){const u=$e(l,i)/1e3;return Ve(a?.roundingMethod)(u)}function qe(l,i,a){const u=Ue(),d=a?.locale??u.locale??_e,f=2520,w=k(l,i);if(isNaN(w))throw new RangeError("Invalid time value");const m=Object.assign({},a,{addSuffix:a?.addSuffix,comparison:w});let t,s;w>0?(t=j(i),s=j(l)):(t=j(l),s=j(i));const e=Ke(s,t),r=(oe(s)-oe(t))/1e3,o=Math.round((e-r)/60);let h;if(o<2)return a?.includeSeconds?e<5?d.formatDistance("lessThanXSeconds",5,m):e<10?d.formatDistance("lessThanXSeconds",10,m):e<20?d.formatDistance("lessThanXSeconds",20,m):e<40?d.formatDistance("halfAMinute",0,m):e<60?d.formatDistance("lessThanXMinutes",1,m):d.formatDistance("xMinutes",1,m):o===0?d.formatDistance("lessThanXMinutes",1,m):d.formatDistance("xMinutes",o,m);if(o<45)return d.formatDistance("xMinutes",o,m);if(o<90)return d.formatDistance("aboutXHours",1,m);if(o<le){const c=Math.round(o/60);return d.formatDistance("aboutXHours",c,m)}else{if(o<f)return d.formatDistance("xDays",1,m);if(o<U){const c=Math.round(o/le);return d.formatDistance("xDays",c,m)}else if(o<U*2)return h=Math.round(o/U),d.formatDistance("aboutXMonths",h,m)}if(h=Ge(s,t),h<12){const c=Math.round(o/U);return d.formatDistance("xMonths",c,m)}else{const c=h%12,g=Math.trunc(h/12);return c<3?d.formatDistance("aboutXYears",g,m):c<9?d.formatDistance("overXYears",g,m):d.formatDistance("almostXYears",g+1,m)}}function We(l,i){return qe(l,ke(l),i)}function Ze(){return de({queryKey:["/api/admin/stats"],queryFn:async()=>await X.getStats()})}function Je(){const l=Le();return q.useEffect(()=>{const i=X.subscribeToVisitorRequests(a=>{l.setQueryData(["/api/admin/visitor-requests"],a)});return()=>{i()}},[l]),de({queryKey:["/api/admin/visitor-requests"],queryFn:async()=>await X.getAllVisitorRequestsWithDetails(),staleTime:1/0})}var et=Object.defineProperty,Q=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,ce=(l,i,a)=>i in l?et(l,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[i]=a,G=(l,i)=>{for(var a in i||(i={}))ue.call(i,a)&&ce(l,a,i[a]);if(Q)for(var a of Q(i))he.call(i,a)&&ce(l,a,i[a]);return l},K=(l,i)=>{var a={};for(var u in l)ue.call(l,u)&&i.indexOf(u)<0&&(a[u]=l[u]);if(l!=null&&Q)for(var u of Q(l))i.indexOf(u)<0&&he.call(l,u)&&(a[u]=l[u]);return a};var I;(l=>{const i=class N{constructor(t,s,e,r){if(this.version=t,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],t<N.MIN_VERSION||t>N.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=t*4+17;let o=[];for(let c=0;c<this.size;c++)o.push(!1);for(let c=0;c<this.size;c++)this.modules.push(o.slice()),this.isFunction.push(o.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(e);if(this.drawCodewords(h),r==-1){let c=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const x=this.getPenaltyScore();x<c&&(r=g,c=x),this.applyMask(g)}}d(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}static encodeText(t,s){const e=l.QrSegment.makeSegments(t);return N.encodeSegments(e,s)}static encodeBinary(t,s){const e=l.QrSegment.makeBytes(t);return N.encodeSegments([e],s)}static encodeSegments(t,s,e=1,r=40,o=-1,h=!0){if(!(N.MIN_VERSION<=e&&e<=r&&r<=N.MAX_VERSION)||o<-1||o>7)throw new RangeError("Invalid value");let c,g;for(c=e;;c++){const p=N.getNumDataCodewords(c,s)*8,b=w.getTotalBits(t,c);if(b<=p){g=b;break}if(c>=r)throw new RangeError("Data too long")}for(const p of[N.Ecc.MEDIUM,N.Ecc.QUARTILE,N.Ecc.HIGH])h&&g<=N.getNumDataCodewords(c,p)*8&&(s=p);let x=[];for(const p of t){a(p.mode.modeBits,4,x),a(p.numChars,p.mode.numCharCountBits(c),x);for(const b of p.getData())x.push(b)}d(x.length==g);const y=N.getNumDataCodewords(c,s)*8;d(x.length<=y),a(0,Math.min(4,y-x.length),x),a(0,(8-x.length%8)%8,x),d(x.length%8==0);for(let p=236;x.length<y;p^=253)a(p,8,x);let C=[];for(;C.length*8<x.length;)C.push(0);return x.forEach((p,b)=>C[b>>>3]|=p<<7-(b&7)),new N(c,s,C,o)}getModule(t,s){return 0<=t&&t<this.size&&0<=s&&s<this.size&&this.modules[s][t]}getModules(){return this.modules}drawFunctionPatterns(){for(let e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),s=t.length;for(let e=0;e<s;e++)for(let r=0;r<s;r++)e==0&&r==0||e==0&&r==s-1||e==s-1&&r==0||this.drawAlignmentPattern(t[e],t[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const s=this.errorCorrectionLevel.formatBits<<3|t;let e=s;for(let o=0;o<10;o++)e=e<<1^(e>>>9)*1335;const r=(s<<10|e)^21522;d(r>>>15==0);for(let o=0;o<=5;o++)this.setFunctionModule(8,o,u(r,o));this.setFunctionModule(8,7,u(r,6)),this.setFunctionModule(8,8,u(r,7)),this.setFunctionModule(7,8,u(r,8));for(let o=9;o<15;o++)this.setFunctionModule(14-o,8,u(r,o));for(let o=0;o<8;o++)this.setFunctionModule(this.size-1-o,8,u(r,o));for(let o=8;o<15;o++)this.setFunctionModule(8,this.size-15+o,u(r,o));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let e=0;e<12;e++)t=t<<1^(t>>>11)*7973;const s=this.version<<12|t;d(s>>>18==0);for(let e=0;e<18;e++){const r=u(s,e),o=this.size-11+e%3,h=Math.floor(e/3);this.setFunctionModule(o,h,r),this.setFunctionModule(h,o,r)}}drawFinderPattern(t,s){for(let e=-4;e<=4;e++)for(let r=-4;r<=4;r++){const o=Math.max(Math.abs(r),Math.abs(e)),h=t+r,c=s+e;0<=h&&h<this.size&&0<=c&&c<this.size&&this.setFunctionModule(h,c,o!=2&&o!=4)}}drawAlignmentPattern(t,s){for(let e=-2;e<=2;e++)for(let r=-2;r<=2;r++)this.setFunctionModule(t+r,s+e,Math.max(Math.abs(r),Math.abs(e))!=1)}setFunctionModule(t,s,e){this.modules[s][t]=e,this.isFunction[s][t]=!0}addEccAndInterleave(t){const s=this.version,e=this.errorCorrectionLevel;if(t.length!=N.getNumDataCodewords(s,e))throw new RangeError("Invalid argument");const r=N.NUM_ERROR_CORRECTION_BLOCKS[e.ordinal][s],o=N.ECC_CODEWORDS_PER_BLOCK[e.ordinal][s],h=Math.floor(N.getNumRawDataModules(s)/8),c=r-h%r,g=Math.floor(h/r);let x=[];const y=N.reedSolomonComputeDivisor(o);for(let p=0,b=0;p<r;p++){let M=t.slice(b,b+g-o+(p<c?0:1));b+=M.length;const T=N.reedSolomonComputeRemainder(M,y);p<c&&M.push(0),x.push(M.concat(T))}let C=[];for(let p=0;p<x[0].length;p++)x.forEach((b,M)=>{(p!=g-o||M>=c)&&C.push(b[p])});return d(C.length==h),C}drawCodewords(t){if(t.length!=Math.floor(N.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let e=this.size-1;e>=1;e-=2){e==6&&(e=5);for(let r=0;r<this.size;r++)for(let o=0;o<2;o++){const h=e-o,g=(e+1&2)==0?this.size-1-r:r;!this.isFunction[g][h]&&s<t.length*8&&(this.modules[g][h]=u(t[s>>>3],7-(s&7)),s++)}}d(s==t.length*8)}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let s=0;s<this.size;s++)for(let e=0;e<this.size;e++){let r;switch(t){case 0:r=(e+s)%2==0;break;case 1:r=s%2==0;break;case 2:r=e%3==0;break;case 3:r=(e+s)%3==0;break;case 4:r=(Math.floor(e/3)+Math.floor(s/2))%2==0;break;case 5:r=e*s%2+e*s%3==0;break;case 6:r=(e*s%2+e*s%3)%2==0;break;case 7:r=((e+s)%2+e*s%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[s][e]&&r&&(this.modules[s][e]=!this.modules[s][e])}}getPenaltyScore(){let t=0;for(let o=0;o<this.size;o++){let h=!1,c=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[o][x]==h?(c++,c==5?t+=N.PENALTY_N1:c>5&&t++):(this.finderPenaltyAddHistory(c,g),h||(t+=this.finderPenaltyCountPatterns(g)*N.PENALTY_N3),h=this.modules[o][x],c=1);t+=this.finderPenaltyTerminateAndCount(h,c,g)*N.PENALTY_N3}for(let o=0;o<this.size;o++){let h=!1,c=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[x][o]==h?(c++,c==5?t+=N.PENALTY_N1:c>5&&t++):(this.finderPenaltyAddHistory(c,g),h||(t+=this.finderPenaltyCountPatterns(g)*N.PENALTY_N3),h=this.modules[x][o],c=1);t+=this.finderPenaltyTerminateAndCount(h,c,g)*N.PENALTY_N3}for(let o=0;o<this.size-1;o++)for(let h=0;h<this.size-1;h++){const c=this.modules[o][h];c==this.modules[o][h+1]&&c==this.modules[o+1][h]&&c==this.modules[o+1][h+1]&&(t+=N.PENALTY_N2)}let s=0;for(const o of this.modules)s=o.reduce((h,c)=>h+(c?1:0),s);const e=this.size*this.size,r=Math.ceil(Math.abs(s*20-e*10)/e)-1;return d(0<=r&&r<=9),t+=r*N.PENALTY_N4,d(0<=t&&t<=2568888),t}getAlignmentPatternPositions(){if(this.version==1)return[];{const t=Math.floor(this.version/7)+2,s=this.version==32?26:Math.ceil((this.version*4+4)/(t*2-2))*2;let e=[6];for(let r=this.size-7;e.length<t;r-=s)e.splice(1,0,r);return e}}static getNumRawDataModules(t){if(t<N.MIN_VERSION||t>N.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*t+128)*t+64;if(t>=2){const e=Math.floor(t/7)+2;s-=(25*e-10)*e-55,t>=7&&(s-=36)}return d(208<=s&&s<=29648),s}static getNumDataCodewords(t,s){return Math.floor(N.getNumRawDataModules(t)/8)-N.ECC_CODEWORDS_PER_BLOCK[s.ordinal][t]*N.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][t]}static reedSolomonComputeDivisor(t){if(t<1||t>255)throw new RangeError("Degree out of range");let s=[];for(let r=0;r<t-1;r++)s.push(0);s.push(1);let e=1;for(let r=0;r<t;r++){for(let o=0;o<s.length;o++)s[o]=N.reedSolomonMultiply(s[o],e),o+1<s.length&&(s[o]^=s[o+1]);e=N.reedSolomonMultiply(e,2)}return s}static reedSolomonComputeRemainder(t,s){let e=s.map(r=>0);for(const r of t){const o=r^e.shift();e.push(0),s.forEach((h,c)=>e[c]^=N.reedSolomonMultiply(h,o))}return e}static reedSolomonMultiply(t,s){if(t>>>8||s>>>8)throw new RangeError("Byte out of range");let e=0;for(let r=7;r>=0;r--)e=e<<1^(e>>>7)*285,e^=(s>>>r&1)*t;return d(e>>>8==0),e}finderPenaltyCountPatterns(t){const s=t[1];d(s<=this.size*3);const e=s>0&&t[2]==s&&t[3]==s*3&&t[4]==s&&t[5]==s;return(e&&t[0]>=s*4&&t[6]>=s?1:0)+(e&&t[6]>=s*4&&t[0]>=s?1:0)}finderPenaltyTerminateAndCount(t,s,e){return t&&(this.finderPenaltyAddHistory(s,e),s=0),s+=this.size,this.finderPenaltyAddHistory(s,e),this.finderPenaltyCountPatterns(e)}finderPenaltyAddHistory(t,s){s[0]==0&&(t+=this.size),s.pop(),s.unshift(t)}};i.MIN_VERSION=1,i.MAX_VERSION=40,i.PENALTY_N1=3,i.PENALTY_N2=3,i.PENALTY_N3=40,i.PENALTY_N4=10,i.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],i.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],l.QrCode=i;function a(m,t,s){if(t<0||t>31||m>>>t)throw new RangeError("Value out of range");for(let e=t-1;e>=0;e--)s.push(m>>>e&1)}function u(m,t){return(m>>>t&1)!=0}function d(m){if(!m)throw new Error("Assertion error")}const f=class v{constructor(t,s,e){if(this.mode=t,this.numChars=s,this.bitData=e,s<0)throw new RangeError("Invalid argument");this.bitData=e.slice()}static makeBytes(t){let s=[];for(const e of t)a(e,8,s);return new v(v.Mode.BYTE,t.length,s)}static makeNumeric(t){if(!v.isNumeric(t))throw new RangeError("String contains non-numeric characters");let s=[];for(let e=0;e<t.length;){const r=Math.min(t.length-e,3);a(parseInt(t.substring(e,e+r),10),r*3+1,s),e+=r}return new v(v.Mode.NUMERIC,t.length,s)}static makeAlphanumeric(t){if(!v.isAlphanumeric(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");let s=[],e;for(e=0;e+2<=t.length;e+=2){let r=v.ALPHANUMERIC_CHARSET.indexOf(t.charAt(e))*45;r+=v.ALPHANUMERIC_CHARSET.indexOf(t.charAt(e+1)),a(r,11,s)}return e<t.length&&a(v.ALPHANUMERIC_CHARSET.indexOf(t.charAt(e)),6,s),new v(v.Mode.ALPHANUMERIC,t.length,s)}static makeSegments(t){return t==""?[]:v.isNumeric(t)?[v.makeNumeric(t)]:v.isAlphanumeric(t)?[v.makeAlphanumeric(t)]:[v.makeBytes(v.toUtf8ByteArray(t))]}static makeEci(t){let s=[];if(t<0)throw new RangeError("ECI assignment value out of range");if(t<128)a(t,8,s);else if(t<16384)a(2,2,s),a(t,14,s);else if(t<1e6)a(6,3,s),a(t,21,s);else throw new RangeError("ECI assignment value out of range");return new v(v.Mode.ECI,0,s)}static isNumeric(t){return v.NUMERIC_REGEX.test(t)}static isAlphanumeric(t){return v.ALPHANUMERIC_REGEX.test(t)}getData(){return this.bitData.slice()}static getTotalBits(t,s){let e=0;for(const r of t){const o=r.mode.numCharCountBits(s);if(r.numChars>=1<<o)return 1/0;e+=4+o+r.bitData.length}return e}static toUtf8ByteArray(t){t=encodeURI(t);let s=[];for(let e=0;e<t.length;e++)t.charAt(e)!="%"?s.push(t.charCodeAt(e)):(s.push(parseInt(t.substring(e+1,e+3),16)),e+=2);return s}};f.NUMERIC_REGEX=/^[0-9]*$/,f.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,f.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let w=f;l.QrSegment=f})(I||(I={}));(l=>{(i=>{const a=class{constructor(d,f){this.ordinal=d,this.formatBits=f}};a.LOW=new a(0,1),a.MEDIUM=new a(1,0),a.QUARTILE=new a(2,3),a.HIGH=new a(3,2),i.Ecc=a})(l.QrCode||(l.QrCode={}))})(I||(I={}));(l=>{(i=>{const a=class{constructor(d,f){this.modeBits=d,this.numBitsCharCount=f}numCharCountBits(d){return this.numBitsCharCount[Math.floor((d+7)/17)]}};a.NUMERIC=new a(1,[10,12,14]),a.ALPHANUMERIC=new a(2,[9,11,13]),a.BYTE=new a(4,[8,16,16]),a.KANJI=new a(8,[8,10,12]),a.ECI=new a(7,[0,0,0]),i.Mode=a})(l.QrSegment||(l.QrSegment={}))})(I||(I={}));var P=I;var tt={L:P.QrCode.Ecc.LOW,M:P.QrCode.Ecc.MEDIUM,Q:P.QrCode.Ecc.QUARTILE,H:P.QrCode.Ecc.HIGH},fe=128,me="L",xe="#FFFFFF",ge="#000000",pe=!1,Ne=1,st=4,nt=0,rt=.1;function we(l,i=0){const a=[];return l.forEach(function(u,d){let f=null;u.forEach(function(w,m){if(!w&&f!==null){a.push(`M${f+i} ${d+i}h${m-f}v1H${f+i}z`),f=null;return}if(m===u.length-1){if(!w)return;f===null?a.push(`M${m+i},${d+i} h1v1H${m+i}z`):a.push(`M${f+i},${d+i} h${m+1-f}v1H${f+i}z`);return}w&&f===null&&(f=m)})}),a.join("")}function ve(l,i){return l.slice().map((a,u)=>u<i.y||u>=i.y+i.h?a:a.map((d,f)=>f<i.x||f>=i.x+i.w?d:!1))}function it(l,i,a,u){if(u==null)return null;const d=l.length+a*2,f=Math.floor(i*rt),w=d/i,m=(u.width||f)*w,t=(u.height||f)*w,s=u.x==null?l.length/2-m/2:u.x*w,e=u.y==null?l.length/2-t/2:u.y*w,r=u.opacity==null?1:u.opacity;let o=null;if(u.excavate){let c=Math.floor(s),g=Math.floor(e),x=Math.ceil(m+s-c),y=Math.ceil(t+e-g);o={x:c,y:g,w:x,h:y}}const h=u.crossOrigin;return{x:s,y:e,h:t,w:m,excavation:o,opacity:r,crossOrigin:h}}function at(l,i){return i!=null?Math.max(Math.floor(i),0):l?st:nt}function be({value:l,level:i,minVersion:a,includeMargin:u,marginSize:d,imageSettings:f,size:w,boostLevel:m}){let t=E.useMemo(()=>{const c=(Array.isArray(l)?l:[l]).reduce((g,x)=>(g.push(...P.QrSegment.makeSegments(x)),g),[]);return P.QrCode.encodeSegments(c,tt[i],a,void 0,void 0,m)},[l,i,a,m]);const{cells:s,margin:e,numCells:r,calculatedImageSettings:o}=E.useMemo(()=>{let h=t.getModules();const c=at(u,d),g=h.length+c*2,x=it(h,w,c,f);return{cells:h,margin:c,numCells:g,calculatedImageSettings:x}},[t,w,f,u,d]);return{qrcode:t,margin:e,cells:s,numCells:r,calculatedImageSettings:o}}var ot=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),Ee=E.forwardRef(function(i,a){const u=i,{value:d,size:f=fe,level:w=me,bgColor:m=xe,fgColor:t=ge,includeMargin:s=pe,minVersion:e=Ne,boostLevel:r,marginSize:o,imageSettings:h}=u,g=K(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:x}=g,y=K(g,["style"]),C=h?.src,p=E.useRef(null),b=E.useRef(null),M=E.useCallback(S=>{p.current=S,typeof a=="function"?a(S):a&&(a.current=S)},[a]),[T,W]=E.useState(!1),{margin:D,cells:V,numCells:$,calculatedImageSettings:R}=be({value:d,level:w,minVersion:e,boostLevel:r,includeMargin:s,marginSize:o,imageSettings:h,size:f});E.useEffect(()=>{if(p.current!=null){const S=p.current,A=S.getContext("2d");if(!A)return;let J=V;const L=b.current,ee=R!=null&&L!==null&&L.complete&&L.naturalHeight!==0&&L.naturalWidth!==0;ee&&R.excavation!=null&&(J=ve(V,R.excavation));const te=window.devicePixelRatio||1;S.height=S.width=f*te;const se=f/$*te;A.scale(se,se),A.fillStyle=m,A.fillRect(0,0,$,$),A.fillStyle=t,ot?A.fill(new Path2D(we(J,D))):V.forEach(function(je,ye){je.forEach(function(Me,Re){Me&&A.fillRect(Re+D,ye+D,1,1)})}),R&&(A.globalAlpha=R.opacity),ee&&A.drawImage(L,R.x+D,R.y+D,R.w,R.h)}}),E.useEffect(()=>{W(!1)},[C]);const Ce=G({height:f,width:f},x);let Z=null;return C!=null&&(Z=E.createElement("img",{src:C,key:C,style:{display:"none"},onLoad:()=>{W(!0)},ref:b,crossOrigin:R?.crossOrigin})),E.createElement(E.Fragment,null,E.createElement("canvas",G({style:Ce,height:f,width:f,ref:M,role:"img"},y)),Z)});Ee.displayName="QRCodeCanvas";var lt=E.forwardRef(function(i,a){const u=i,{value:d,size:f=fe,level:w=me,bgColor:m=xe,fgColor:t=ge,includeMargin:s=pe,minVersion:e=Ne,boostLevel:r,title:o,marginSize:h,imageSettings:c}=u,g=K(u,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:x,cells:y,numCells:C,calculatedImageSettings:p}=be({value:d,level:w,minVersion:e,boostLevel:r,includeMargin:s,marginSize:h,imageSettings:c,size:f});let b=y,M=null;c!=null&&p!=null&&(p.excavation!=null&&(b=ve(y,p.excavation)),M=E.createElement("image",{href:c.src,height:p.h,width:p.w,x:p.x+x,y:p.y+x,preserveAspectRatio:"none",opacity:p.opacity,crossOrigin:p.crossOrigin}));const T=we(b,x);return E.createElement("svg",G({height:f,width:f,viewBox:`0 0 ${C} ${C}`,ref:a,role:"img"},g),!!o&&E.createElement("title",null,o),E.createElement("path",{fill:m,d:`M0,0 h${C}v${C}H0z`,shapeRendering:"crispEdges"}),E.createElement("path",{fill:t,d:T,shapeRendering:"crispEdges"}),M)});lt.displayName="QRCodeSVG";function bt(){const[,l]=Oe(),{user:i}=Fe(),{data:a,isLoading:u}=Ze(),{data:d,isLoading:f}=Je();if(q.useEffect(()=>{i?.residencyName&&(document.title=`${i.residencyName} Admin Dashboard`)},[i?.residencyName]),u||f)return n.jsx(ie,{children:n.jsx("div",{className:"flex justify-center p-12",children:n.jsx(Ae,{className:"h-8 w-8 animate-spin text-primary"})})});const w=e=>({pending:"bg-yellow-100 text-yellow-800 border-yellow-300",approved:"bg-green-100 text-green-800 border-green-300",rejected:"bg-red-100 text-red-800 border-red-300",entered:"bg-blue-100 text-blue-800 border-blue-300",exited:"bg-gray-100 text-gray-800 border-gray-300"})[e]||"bg-gray-100 text-gray-800",m=e=>{switch(e){case"approved":return n.jsx(Y,{className:"w-4 h-4"});case"rejected":return n.jsx(De,{className:"w-4 h-4"});case"entered":return n.jsx(re,{className:"w-4 h-4"});case"exited":return n.jsx(Pe,{className:"w-4 h-4"});default:return n.jsx(H,{className:"w-4 h-4"})}},t=e=>e.charAt(0).toUpperCase()+e.slice(1),s=e=>{const r=["pending"];return["approved","entered","exited"].includes(e)&&r.push("approved"),e==="rejected"&&r.push("rejected"),["entered","exited"].includes(e)&&r.push("entered"),e==="exited"&&r.push("exited"),r};return n.jsx(ie,{children:n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-3xl font-bold text-slate-900","data-testid":"text-admin-title",children:[i?.residencyName," Admin Dashboard"]}),n.jsxs("p",{className:"text-slate-500 mt-1",children:["Real-time visitor entry management system overview for ",i?.residencyName]})]}),n.jsxs(ae,{onClick:()=>{const e=i.residencyName?`/${encodeURIComponent(i.residencyName)}`:"";l(`${e}/admin/management`)},"data-testid":"button-management",className:"gap-2",children:[n.jsx(Se,{className:"w-4 h-4"}),"Management"]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx(_,{title:"Total Visitors",value:a?.totalVisitors||0,icon:n.jsx(ne,{className:"h-6 w-6 text-blue-600"}),description:"All time entries","data-testid":"stat-total-visitors"}),n.jsx(_,{title:"Pending Requests",value:a?.pendingRequests||0,icon:n.jsx(H,{className:"h-6 w-6 text-amber-600"}),description:"Awaiting resident action","data-testid":"stat-pending-requests"}),n.jsx(_,{title:"Currently On Campus",value:a?.activeVisitors||0,icon:n.jsx(Ie,{className:"h-6 w-6 text-emerald-600"}),description:"Checked in now","data-testid":"stat-active-visitors"}),n.jsx(_,{title:"Approved Today",value:d?.filter(e=>e.status==="approved").length||0,icon:n.jsx(Y,{className:"h-6 w-6 text-green-600"}),description:"Total approved","data-testid":"stat-approved-today"})]}),n.jsxs(O,{children:[n.jsxs(B,{children:[n.jsx(z,{className:"text-lg",children:"Visitor Form QR Code"}),n.jsxs(Te,{children:["Scan this QR code to open the visitor registration form for ",i?.residencyName]})]}),n.jsx(F,{className:"flex flex-col items-center justify-center p-6",children:i?.residencyName?n.jsxs("div",{className:"flex flex-col items-center gap-4",children:[n.jsx("div",{className:"bg-white p-4 rounded-xl shadow-lg border",children:n.jsx(Ee,{value:`${window.location.origin}/visitor-form/${encodeURIComponent(i.residencyName)}`,size:200})}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Visitor Link:"}),n.jsx("code",{className:"bg-slate-100 px-3 py-1 rounded text-sm text-slate-700 break-all",children:`${window.location.origin}/visitor-form/${encodeURIComponent(i.residencyName)}`})]}),n.jsx(ae,{variant:"outline",onClick:()=>{const e=`${window.location.origin}/visitor-form/${encodeURIComponent(i.residencyName)}`;navigator.clipboard.writeText(e)},children:"Copy Link"})]}):n.jsx("div",{className:"text-slate-500",children:"Loading residency info..."})})]}),n.jsxs(O,{children:[n.jsxs(B,{children:[n.jsx(z,{className:"text-lg",children:"Visitor Entry Data Flow"}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"How visitor requests move through the system"})]}),n.jsx(F,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"bg-slate-50 rounded-lg p-6",children:[n.jsxs("div",{className:"grid grid-cols-5 gap-2 text-center",children:[n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-200 flex items-center justify-center mb-2",children:n.jsx(H,{className:"w-6 h-6 text-yellow-700"})}),n.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Pending"}),n.jsx("span",{className:"text-xs text-slate-500 mt-1",children:"Visitor submits"})]}),n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("div",{className:"w-8 h-1 bg-slate-300"})}),n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-green-200 flex items-center justify-center mb-2",children:n.jsx(Y,{className:"w-6 h-6 text-green-700"})}),n.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Approved"}),n.jsx("span",{className:"text-xs text-slate-500 mt-1",children:"Resident approves"})]}),n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("div",{className:"w-8 h-1 bg-slate-300"})}),n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-200 flex items-center justify-center mb-2",children:n.jsx(re,{className:"w-6 h-6 text-blue-700"})}),n.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Entered"}),n.jsx("span",{className:"text-xs text-slate-500 mt-1",children:"Guard verifies"})]})]}),n.jsx("p",{className:"text-xs text-slate-500 mt-6 text-center",children:"Visitors can also be rejected at the Pending stage. After entry, they exit when leaving."})]}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:["pending","approved","rejected","entered","exited"].map(e=>n.jsxs("div",{className:"bg-slate-100 rounded p-3 text-center",children:[n.jsx("div",{className:"text-2xl font-bold text-slate-900",children:d?.filter(r=>r.status===e).length||0}),n.jsx("div",{className:"text-xs text-slate-600 capitalize font-medium",children:e})]},e))})]})})]}),n.jsxs(O,{children:[n.jsxs(B,{children:[n.jsx(z,{className:"text-lg",children:"Complete Visitor Request Log"}),n.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"All visitor entries with precise data and status flow"})]}),n.jsx(F,{children:!d||d.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(ne,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500 font-medium",children:"No visitor requests yet"}),n.jsx("p",{className:"text-slate-400 text-sm",children:"Visitor requests will appear here"})]}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-200 bg-slate-50",children:[n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"ID"}),n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"Visitor Name"}),n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"Phone"}),n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"Block • Flat"}),n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"Purpose"}),n.jsx("th",{className:"text-center p-3 font-semibold text-slate-700",children:"Status Flow"}),n.jsx("th",{className:"text-left p-3 font-semibold text-slate-700",children:"Submitted"})]})}),n.jsx("tbody",{children:d.map(e=>n.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50","data-testid":`row-visitor-${e.id}`,children:[n.jsxs("td",{className:"p-3 text-slate-700 font-mono text-xs",children:["#",e.id]}),n.jsx("td",{className:"p-3 text-slate-900 font-medium",children:e.visitorName}),n.jsx("td",{className:"p-3 text-slate-600",children:e.visitorPhone}),n.jsx("td",{className:"p-3 text-slate-700",children:n.jsxs("span",{className:"font-mono text-xs",children:[e.flat.block.name," • Flat ",e.flat.number]})}),n.jsx("td",{className:"p-3 text-slate-600",children:e.purpose}),n.jsx("td",{className:"p-3",children:n.jsx("div",{className:"flex gap-1 justify-center flex-wrap",children:s(e.status).map(r=>n.jsxs(Be,{variant:"outline",className:`${w(r)} border text-xs capitalize flex items-center gap-1`,children:[m(r),t(r)]},r))})}),n.jsx("td",{className:"p-3 text-slate-500 text-xs","data-testid":`text-timestamp-${e.id}`,children:We(new Date(e.createdAt),{addSuffix:!0})})]},e.id))})]})})})]}),n.jsxs(O,{children:[n.jsx(B,{children:n.jsx(z,{className:"text-lg",children:"System Data Flow Architecture"})}),n.jsxs(F,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Public Entry"}),n.jsx("p",{className:"text-sm text-blue-800",children:"Visitor scans QR → Submits form (Name, Phone, Block, Flat, Purpose) → Request created with PENDING status"})]}),n.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[n.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"Resident Approval"}),n.jsx("p",{className:"text-sm text-green-800",children:"Resident logs in → Sees requests for their flat → Approves or Rejects → Status updates in real-time"})]}),n.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[n.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"Guard Verification"}),n.jsx("p",{className:"text-sm text-purple-800",children:"Guard sees approved requests → Marks ENTERED when visitor checks in → Marks EXITED when visitor leaves"})]})]}),n.jsx("div",{className:"bg-slate-100 p-4 rounded-lg border-l-4 border-slate-400",children:n.jsxs("p",{className:"text-sm text-slate-700",children:[n.jsx("strong",{children:"Admin Visibility:"})," This dashboard shows all requests across all flats and blocks in real-time. Each request flows through the system in a precise, trackable way: Visitor Submission → Resident Decision → Guard Verification → System Completion."]})})]})]})]})})}const _=q.memo(function({title:i,value:a,icon:u,description:d,...f}){return n.jsx(O,{...f,children:n.jsx(F,{className:"p-6",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-500 text-sm mb-1",children:i}),n.jsx("div",{className:"text-3xl font-bold font-display text-slate-900",children:a}),n.jsx("div",{className:"text-xs text-slate-400 mt-2",children:d})]}),n.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:u})]})})})});export{bt as default};
